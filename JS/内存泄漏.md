# 内存泄漏

## 一、什么是内存泄漏

不再用到的内存没有及时释放，就叫做**内存泄漏**（Memery leak）。

对于持续运行的服务进程，必须及时释放不再用到的内存。否则，内存占用越来越高，轻则影响系统性能，重则导致进程崩溃。

## 二、垃圾回收机制

语言自动提供自动内存管理，这被称为“垃圾回收机制”。

垃圾回收机制怎么知道哪些内存不再使用了呢？

### 引用计数

引用计数指跟踪每个值被引用的次数：语言引擎有一张“引用表”，保存了内存里所有的资源（通常是各种值）的引用次数。如果一个值的引用次数是 0，就表示这个值不再用到了，因此就可以将这块内存释放。

![引用计数](./img/引用计数.jpg)

如果一个值不再需要了，引用数却不为 0，垃圾回收机制无法释放这块内存，从而导致内存泄漏。

```javascript
const arr = [1, 2, 3, 4];
```

上面代码中，数组`[1, 2, 3, 4]`是一个值，会占用内存。变量`arr`是仅有的对这个值的引用，因此引用次数为`1`。尽管后面的代码没有用到`arr`，它还是会持续占用内存。



